<!DOCTYPE html>

<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

  <style>
    body,
    div,
    html {
      margin: 0;
    }
    
    .u_fixed {
      position: fixed !important;
      top: 0;
    }
    .post-header {
     width: 100%;
     position: relative;
    }
    .post-header-img {
      width: 100%;
      height: 80vh;
    }

    .post-header-title {
      font-family: 'Open Sans', Arial, sans-serif;
      font-weight: 900;
      font-size: 24px;
      color: rgb(50,50,50);
      padding-left: 75px;
      width: 100%;
      position: absolute;
      bottom: 50vh;
      z-index: 10;
      clear: both;
      opacity: 1;
    }

  </style>
</head>

<body>

<div id="one" class="post">
  <div id="one-header" class = "post-header">
    <div class="post-header-img">
      <img class="post-header-img" src="assets/img/sample-one.jpg">
    </div>

    <div class="post-header-title">
      <h1>This is a One!</h1>
      <h2>And a subtitle to boot!</h2>
    </div>
  </div>

  <div class="spacer"></div>
  <div class="post-text">
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
  </div>
</div>


<div id="two" class="post">
  <div id="two-header" class = "post-header">
    <div class="post-header-img">
      <img class="post-header-img" src="assets/img/sample-two.jpg">
    </div>

    <div class="post-header-title">
      <h1>This is Post Two!</h1>
      <h2>And a subtitle to boot!</h2>
    </div>
  </div>
  <div class="spacer"></div>
  <div class="post-text">
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
  </div>
</div>

<div id="tree" class="post">
  <div id="tree-header" class = "post-header">
    <div class="post-header-img">
      <img class="post-header-img" src="assets/img/sample-three.jpg">
    </div>

    <div class="post-header-title">
      <h1>This is Post Tree!</h1>
      <h2>And a subtitle to boot!</h2>
    </div>
  </div>

  <div class="spacer"></div>
  <div class="post-text">
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
  </div>
</div>

<div id="fo" class="post">
  <div id="fo-header" class= "post-header">
    <div class="post-header-img">
      <img class="post-header-img" src="assets/img/sample-four.jpg">
    </div>

    <div class="post-header-title">
      <h1>This is Post Fo!</h1>
      <h2>And a subtitle to boot!</h2>
    </div>
  </div>
  <div class="spacer"></div>
  <div class="post-text">
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
    <p>Unga bunga</p>
  </div>
</div>




</body>

<script>

// global to track the scroll position of each post
var prevDispl = [];

$(window).scroll(function() {
  $('.post').each(function(index, value) {

    // get the offsets. Notice we are detecting the shift
    // of the top of the post to the window. Thus, when
    // the height of the window changes due to fixing the
    // header, the offset will not change.
    var window_top = $(window).scrollTop();
    var post_top = $(this).offset().top;
    var displ = window_top - post_top;

    // get the children
    // TODO: Check for reuse, if not reused, elminate
    var headerObj = $(this).children('.post-header');
    var spacerObj = $(this).children('.spacer');
    var imgObj = headerObj.children('.post-header-img');
    var titleObj = headerObj.children('.post-header-title');

    // get some data
    // TODO: Check for reuse to optimise.
    var imgHeight = imgObj.outerHeight(true);
    var opacityVal = 1-(displ/imgHeight);

    if(displ < 0) {
      // the header is below the top of hte page, so it appears inline, and
      // scrolls normally.
      headerObj.removeClass('u_fixed');
      imgObj.css('opacity',1);
      spacerObj.css('height',0);
      titleObj.css('bottom','50vh'); //NOTE: Must match the CSS!
    }
    else if (displ < imgHeight) {
      // the div is at the top, and being faded out
      headerObj.addClass('u_fixed');
      imgObj.css('opacity',opacityVal);
      headerObj.css('opacity',opacityVal);
      spacerObj.css('height', imgHeight);

      // slide the title up, but at different rate than
      // the scroll
      var unga = (displ-prevDispl[index])/4;
      titleObj.css({bottom: "+=" + unga});
      prevDispl[index]=displ;

    }
    else {
      // the div is off the top
     imgObj.css('opacity',0);
     headerObj.css('opacity', 0);
    }
  });
});


//      else if (displ < imgHeight) {
//        console.log(displ + "   " + lastDispl + "   " + (displ-lastDispl) );
        // var unga = (displ-lastDispl)/2;
        // titleID.css({bottom: "+=" + unga});
        // lastDispl = displ;



</script>

</html>
